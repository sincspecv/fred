# Milestone v0.3.0: Observability & Safety

**Status:** âœ… SHIPPED 2026-02-07
**Phases:** 22-26
**Total Plans:** 34

## Overview

Fred v0.3.0 delivered production-focused observability, deterministic evaluation and replay, intent-aware tool safety controls, MCP multi-server integration, and routing explainability APIs. The milestone completed all 35 mapped requirements across phases 22-26.

## Phases

### Phase 22: Observability Foundation

**Goal**: Developers can observe and debug agent runs with correlation IDs, spans, and structured logs integrated with their existing monitoring stack.
**Depends on**: Previous phases (1-21.1)
**Plans**: 8 plans

Plans:
- [x] 22-01: Observability core primitives and config wiring
- [x] 22-02: Hook correlation context + telemetry bridge
- [x] 22-03: Message processing correlation + intent tagging
- [x] 22-04: Pipeline/graph span and branch instrumentation
- [x] 22-05: Metrics capture + golden trace export
- [x] 22-06: [GAP] Rewrite correlation context with FiberRef + ALS bridge
- [x] 22-07: [GAP] Wire context into processor + update consumer files
- [x] 22-08: [GAP] Update exports + integration test

**Details:**
- Correlation context propagation and structured telemetry wired across hooks, processor, pipelines, and routing.
- OTel-compatible spans and token/cost metrics shipped, plus golden trace export APIs for evaluation workflows.

### Phase 23: Evaluation Framework

**Goal**: Developers can record, replay, and compare agent runs to detect regressions and validate behavior deterministically.
**Depends on**: Phase 22
**Plans**: 11 plans

Plans:
- [x] 23-01: Deterministic recording artifact pipeline + TraceStorageService
- [x] 23-02: Typed assertions and normalized regression comparator
- [x] 23-03: Checkpoint replay with mocked tools and Effect TestClock
- [x] 23-04: Batch suite runner and per-intent confusion-matrix metrics
- [x] 23-05: CLI commands and public core eval exports
- [x] 23-06: [GAP] Default CLI eval flows wired to core APIs
- [x] 23-07: [GAP] Record layer composition fix + config-less replay path
- [x] 23-08: [GAP] Default suite core wiring + diagnostics + regression coverage
- [x] 23-09: [GAP] CLI eval record layer-composition bug fix
- [x] 23-10: [GAP] Config-less replay mode for artifact/checkpoint validation
- [x] 23-11: [GAP] Suite CLI wired to core runner with unified eval behavior

**Details:**
- Deterministic trace artifacts and replay runtime with strict mock enforcement.
- Regression compare/suite flows delivered in both core and CLI surfaces, including artifact-only replay mode.

### Phase 24: Tool Access Control

**Goal**: Developers can define and enforce fine-grained tool access policies based on intent, user roles, and context with full audit trails.
**Depends on**: Phases 22-23
**Plans**: 6 plans

Plans:
- [x] 24-01: Policy DSL and config validation for default/intent/agent inheritance
- [x] 24-02: Deterministic tool capability auto-tagging
- [x] 24-03: ToolGateService evaluator, layering, and hot-reload behavior
- [x] 24-04: Discovery-time gating and explicit runtime denial handling
- [x] 24-05: Audit hook events with hashed payloads
- [x] 24-06: HITL approval workflow for requireApproval policies

**Details:**
- Deterministic policy evaluation with deny precedence and hot-reload semantics.
- Discovery-time filtering ensures denied tools never reach the model; policy decisions are audit logged.

### Phase 25: MCP Integration

**Goal**: Developers can discover and use tools from external MCP servers with automatic lifecycle management and safety policies applied.
**Depends on**: Phases 22-24
**Plans**: 6 plans

Plans:
- [x] 25-01: MCP config schema, extraction, env var resolution, and validation
- [x] 25-02: Global MCPServerRegistry with Effect lifecycle and namespaced adapter
- [x] 25-03: Health checks, auto-restart, backoff, lazy startup
- [x] 25-04: MCPResourceService and resilient namespaced discovery
- [x] 25-05: Agent config migration and ToolGate integration
- [x] 25-06: Fred initialization wiring, exports, and integration tests

**Details:**
- Multi-server MCP registry with stdio and HTTP/SSE support, namespace-safe tool IDs, and lifecycle health management.
- MCP tools/resources integrated into Fred agent creation and policy gating paths.

### Phase 26: Routing Explainability

**Goal**: Developers and users can understand why routing decisions were made with confidence scores and alternatives.
**Depends on**: Phase 22
**Plans**: 3 plans

Plans:
- [x] 26-01: Explainability types, calibration module, and explanation generator
- [x] 26-02: Calibration + explanation integration in MessageRouter and IntentMatcher
- [x] 26-03: Conditional hooks, HITL clarification, conversation boost, explain() API, exports

**Details:**
- Routing explanations now include winner rationale, alternatives, concerns, and confidence metadata.
- Public `fred.routing.explain()` API shipped for transparent dry-run analysis.

---

## Milestone Summary

**Decimal Phases:**
- None in v0.3.0

**Key Decisions:**
- Correlation context standardized on FiberRef with AsyncLocalStorage bridge for consistent Effect-native propagation.
- Evaluation flows moved to core-backed CLI paths for deterministic parity between API and CLI.
- Tool gating enforced at discovery time so disallowed tools are never shown to models.
- MCP clients modeled as Effect-managed resources with health checks and auto-restart.
- Routing explanations use numeric confidence and alternatives, with optional calibration for backward compatibility.

**Issues Resolved:**
- Resolved evaluation layer-composition defects in default record flow.
- Added config-less replay for artifact-only validation workflows.
- Closed cross-phase wiring gaps for policy audit hooks, MCP gating, and routing explainability exports.

**Issues Deferred:**
- API documentation for newly shipped v0.3.0 interfaces remains pending.
- Existing pre-v0.3.0 failing service-layer isolation tests remain outside milestone scope.

**Technical Debt Incurred:**
- ROADMAP checkboxes for some phase plans drifted and required milestone archival correction.
- Conversation boost module is implemented and tested but not fully wired into default route execution path.

---

_For current project status, see `.planning/ROADMAP.md`._
